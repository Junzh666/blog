import{_ as c}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as i,o as d,c as p,e as n,w as r,b as a,d as s,f as e}from"./app-j4kN759Y.js";const m={},b=e(`<div class="hint-container tip"><p class="hint-container-title">提示</p><p>本文搭建的apt镜像站只针对x86架构的Ubuntu 22.04。</p></div><h2 id="安装apache2" tabindex="-1"><a class="header-anchor" href="#安装apache2" aria-hidden="true">#</a> 安装apache2</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apache2
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> apache2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建mirror数据所在目录" tabindex="-1"><a class="header-anchor" href="#创建mirror数据所在目录" aria-hidden="true">#</a> 创建mirror数据所在目录</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /home/ubuntu/mirrors
<span class="token function">sudo</span> <span class="token function">chown</span> www-data:www-data /home/ubuntu/mirrors
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装apt-mirror" tabindex="-1"><a class="header-anchor" href="#安装apt-mirror" aria-hidden="true">#</a> 安装apt-mirror</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> apt-mirror
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置apt-mirror" tabindex="-1"><a class="header-anchor" href="#配置apt-mirror" aria-hidden="true">#</a> 配置apt-mirror</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">cp</span> /etc/apt/mirror.list /etc/apt/mirror.list-bak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,9),v=a("div",{class:"language-list line-numbers-mode","data-ext":"list"},[a("pre",{class:"language-list"},[a("code",null,` deb-amd64 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
 deb-amd64 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
 deb-amd64 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
 deb-amd64 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
 deb-amd64 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse

 deb-i386 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse
 deb-i386 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
 deb-i386 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
 deb-i386 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse
 deb-i386 https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse

 clean https://mirrors.tuna.tsinghua.edu.cn/ubuntu/
`)]),a("div",{class:"line-numbers","aria-hidden":"true"},[a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"}),a("div",{class:"line-number"})])],-1),h=e(`<h2 id="启动mirror拉取数据" tabindex="-1"><a class="header-anchor" href="#启动mirror拉取数据" aria-hidden="true">#</a> 启动mirror拉取数据</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> apt-mirror
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>可以在byobu/tmux中运行，也可以丢到后台：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">nohup</span> <span class="token function">sudo</span> apt-mirror <span class="token operator">&amp;</span>
<span class="token function">tail</span> nohup.out
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="问题1" tabindex="-1"><a class="header-anchor" href="#问题1" aria-hidden="true">#</a> 问题1</h2>`,5),k={href:"https://so.csdn.net/so/search?q=%E9%95%9C%E5%83%8F%E6%BA%90&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},g=e(`<h3 id="方法1" tabindex="-1"><a class="header-anchor" href="#方法1" aria-hidden="true">#</a> 方法1</h3><p>创建一个脚本<code>fix-errors.sh</code>自动下载这些文件：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">cd</span> /home/ubuntu/mirrors/mirror/mirrors.tuna.tsinghua.edu.cn/ubuntu/dists

<span class="token keyword">for</span> <span class="token for-or-select variable">dist</span> <span class="token keyword">in</span> jammy jammy-updates jammy-security jammy-backports<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">for</span> <span class="token for-or-select variable">comp</span> <span class="token keyword">in</span> main multiverse universe<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">size</span> <span class="token keyword">in</span> <span class="token number">48</span> <span class="token number">64</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token function">wget</span> http://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/<span class="token variable">$dist</span>/<span class="token variable">$comp</span>/dep11/icons-<span class="token variable">\${size}</span>x<span class="token variable">\${size}</span>@2.tar.gz <span class="token parameter variable">-O</span> <span class="token variable">$dist</span>/<span class="token variable">$comp</span>/dep11/icons-<span class="token variable">\${size}</span>x<span class="token variable">\${size}</span>@2.tar.gz<span class="token punctuation">;</span>
   <span class="token keyword">done</span>
 <span class="token keyword">done</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">cd</span> /var/tmp
<span class="token keyword">for</span> <span class="token for-or-select variable">p</span> <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable">\${1<span class="token operator">:-</span>jammy}</span>&quot;</span><span class="token punctuation">{</span>,-<span class="token punctuation">{</span>security,updates,backports<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">\\</span>
/<span class="token punctuation">{</span>main,restricted,universe,multiverse<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">\${p}</span>&quot;</span>
<span class="token comment">#echo &#39;-----&#39;</span>
<span class="token comment">#echo &quot;http://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/\${p}/cnf/Commands-amd64.xz&quot;</span>
<span class="token function">wget</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-np</span> <span class="token parameter variable">-R</span> <span class="token string">&quot;index.html*&quot;</span> <span class="token string">&quot;http://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/<span class="token variable">\${p}</span>/cnf/Commands-amd64.xz&quot;</span>
<span class="token function">wget</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-np</span> <span class="token parameter variable">-R</span> <span class="token string">&quot;index.html*&quot;</span> <span class="token string">&quot;http://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/<span class="token variable">\${p}</span>/cnf/Commands-i386.xz&quot;</span>
<span class="token function">wget</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-np</span> <span class="token parameter variable">-R</span> <span class="token string">&quot;index.html*&quot;</span> <span class="token string">&quot;http://mirrors.tuna.tsinghua.edu.cn/ubuntu/dists/<span class="token variable">\${p}</span>/binary-i386/&quot;</span>
<span class="token keyword">done</span>

<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-av</span> mirrors.tuna.tsinghua.edu.cn/ubuntu/ /home/ubuntu/mirrors/mirror/mirrors.tuna.tsinghua.edu.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方法2" tabindex="-1"><a class="header-anchor" href="#方法2" aria-hidden="true">#</a> 方法2</h3><p>修改<code>/usr/bin/apt-mirror</code>文件：</p><p>在<code>add_url_to_download( $url . $_ . &quot;/binary-&quot; . $arch . &quot;/Packages.xz&quot; );</code>下添加一行： <code>add_url_to_download( $url . $_ . &quot;/cnf/Commands-&quot; . $arch . &quot;.xz&quot; );</code></p><p>注释掉：<code>$uri =~ s/^([^@]+)?@?// if $uri =~ /@/;</code></p>`,7),f={class:"hint-container tip"},_=a("p",{class:"hint-container-title"},"提示",-1),w={href:"https://www.linuxtechi.com/setup-local-apt-repository-server-ubuntu/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://blog.csdn.net/qq_41280188/article/details/128534607",target:"_blank",rel:"noopener noreferrer"},x=e(`<h2 id="问题2" tabindex="-1"><a class="header-anchor" href="#问题2" aria-hidden="true">#</a> 问题2</h2><p>如果apache出现权限问题注意2个地方</p><ol><li>将源目录的权限修改为www-data用户</li><li>将www-data加入ubuntu组</li></ol><h2 id="创建一个contab每日同步一次mirrors" tabindex="-1"><a class="header-anchor" href="#创建一个contab每日同步一次mirrors" aria-hidden="true">#</a> 创建一个contab每日同步一次mirrors</h2><div class="language-crontab line-numbers-mode" data-ext="crontab"><pre class="language-crontab"><code>00  01  *  *  *  /usr/bin/apt-mirror
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端" aria-hidden="true">#</a> 客户端</h2><div class="language-list line-numbers-mode" data-ext="list"><pre class="language-list"><code>deb  http://mirrors.iciwh.com/ubuntu/ jammy main restricted universe multiverse
deb  http://mirrors.iciwh.com/ubuntu/ jammy-security main restricted universe multiverse
deb  http://mirrors.iciwh.com/ubuntu/ jammy-updates main restricted universe multiverse
deb  http://mirrors.iciwh.com/ubuntu/ jammy-proposed main restricted universe multiverse
deb  http://mirrors.iciwh.com/ubuntu/ jammy-backports main restricted universe multiverse
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="发布镜像" tabindex="-1"><a class="header-anchor" href="#发布镜像" aria-hidden="true">#</a> 发布镜像</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /home/ubuntu/mirrors/mirror/mirrors.tuna.tsinghua.edu.cn/ubuntu /var/www/html/ubuntu
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,9);function q($,j){const o=i("CodeTabs"),t=i("ExternalLinkIcon");return d(),p("div",null,[b,n(o,{id:"21",data:[{id:"mirror.list"}],"tab-id":"language"},{title0:r(({value:u,isActive:l})=>[s("mirror.list")]),tab0:r(({value:u,isActive:l})=>[v]),_:1},8,["data"]),h,a("p",null,[s("在使用apt-mirror工具下载ubuntu22"),a("a",k,[s("镜像源"),n(t)]),s("导入内网后，apt-get update发现缺少dep11，cnf及binary-i386下的一些索引文件，导致更新失败，无法正常使用。这是由于apt-mirror在2017年就停止了维护更新，之后出现的ubuntu20和ubuntu22更新了仓库的索引文件，apt-mirror没有办法兼容。")]),g,a("div",f,[_,a("p",null,[s("参考资料： "),a("a",w,[s("https://www.linuxtechi.com/setup-local-apt-repository-server-ubuntu/"),n(t)]),a("a",y,[s("https://blog.csdn.net/qq_41280188/article/details/128534607"),n(t)])])]),x])}const E=c(m,[["render",q],["__file","private_api.html.vue"]]);export{E as default};
