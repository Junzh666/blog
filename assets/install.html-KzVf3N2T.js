import{_ as u}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as r,c as k,e as o,w as a,b as n,d as s,f as c}from"./app-cOpy3ZSW.js";const d={},m=c(`<h2 id="创建容器" tabindex="-1"><a class="header-anchor" href="#创建容器" aria-hidden="true">#</a> 创建容器</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/work/rocketchat <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> ~/work/rocketchat
<span class="token function">touch</span> docker-compose.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),b=n("div",{class:"language-yaml line-numbers-mode","data-ext":"yml"},[n("pre",{class:"language-yaml"},[n("code",null,[s(),n("span",{class:"token key atrule"},"volumes"),n("span",{class:"token punctuation"},":"),s(`
     `),n("span",{class:"token key atrule"},"mongodb_data"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token key atrule"},"driver"),n("span",{class:"token punctuation"},":"),s(" local "),n("span",{class:"token punctuation"},"}"),s(`
 `),n("span",{class:"token key atrule"},"services"),n("span",{class:"token punctuation"},":"),s(`
   `),n("span",{class:"token key atrule"},"rocketchat"),n("span",{class:"token punctuation"},":"),s(`
     `),n("span",{class:"token key atrule"},"image"),n("span",{class:"token punctuation"},":"),s(" registry.rocket.chat/rocketchat/rocket.chat"),n("span",{class:"token punctuation"},":"),s(`6.2.0
     `),n("span",{class:"token key atrule"},"restart"),n("span",{class:"token punctuation"},":"),s(" on"),n("span",{class:"token punctuation"},"-"),s(`failure
     `),n("span",{class:"token key atrule"},"labels"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token key atrule"},"traefik.enable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"true"'),s(`
       `),n("span",{class:"token key atrule"},"traefik.http.routers.rocketchat.rule"),n("span",{class:"token punctuation"},":"),s(" Host(`$"),n("span",{class:"token punctuation"},"{"),s("DOMAIN"),n("span",{class:"token punctuation"},"}"),s("`)\n       "),n("span",{class:"token key atrule"},"traefik.http.routers.rocketchat.tls"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"true"'),s(`
       `),n("span",{class:"token key atrule"},"traefik.http.routers.rocketchat.entrypoints"),n("span",{class:"token punctuation"},":"),s(` https
       `),n("span",{class:"token key atrule"},"traefik.http.routers.rocketchat.tls.certresolver"),n("span",{class:"token punctuation"},":"),s(` le
     `),n("span",{class:"token key atrule"},"environment"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token key atrule"},"ADMIN_USERNAME"),n("span",{class:"token punctuation"},":"),s(` rc.admin
       `),n("span",{class:"token key atrule"},"ADMIN_PASS"),n("span",{class:"token punctuation"},":"),s(" <set your password"),n("span",{class:"token punctuation"},">"),s(`
       `),n("span",{class:"token key atrule"},"MONGO_URL"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"${MONGO_URL:-mongodb://${MONGODB_ADVERTISED_HOSTNAME:-mongodb}:${MONGODB_INITIAL_PRIMARY_PORT_NUMBER:-27017}/${MONGODB_DATABASE:-rocketchat}?replicaSet=${MONGODB_REPLICA_SET_NAME:-rs0}}"'),s(`
       `),n("span",{class:"token key atrule"},"MONGO_OPLOG_URL"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"${MONGO_OPLOG_URL:-mongodb://${MONGODB_ADVERTISED_HOSTNAME:-mongodb}:${MONGODB_INITIAL_PRIMARY_PORT_NUMBER:-27017}/local?replicaSet=${MONGODB_REPLICA_SET_NAME:-rs0}}"'),s(`
     `),n("span",{class:"token key atrule"},"extra_hosts"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token punctuation"},"-"),s(),n("span",{class:"token string"},'"host.docker.internal:host-gateway"'),s(`
     `),n("span",{class:"token key atrule"},"depends_on"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token punctuation"},"-"),s(` mongodb
     `),n("span",{class:"token key atrule"},"expose"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token punctuation"},"-"),s(" $"),n("span",{class:"token punctuation"},"{"),s("PORT"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"-3000"),n("span",{class:"token punctuation"},"}"),s(`
     `),n("span",{class:"token key atrule"},"ports"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token punctuation"},"-"),s(),n("span",{class:"token string"},'"${BIND_IP:-0.0.0.0}:${HOST_PORT:-3000}:${PORT:-3000}"'),s(`

   `),n("span",{class:"token key atrule"},"mongodb"),n("span",{class:"token punctuation"},":"),s(`
     `),n("span",{class:"token key atrule"},"image"),n("span",{class:"token punctuation"},":"),s(" docker.io/bitnami/mongodb"),n("span",{class:"token punctuation"},":"),s(`latest
     `),n("span",{class:"token key atrule"},"restart"),n("span",{class:"token punctuation"},":"),s(" on"),n("span",{class:"token punctuation"},"-"),s(`failure
     `),n("span",{class:"token key atrule"},"volumes"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token punctuation"},"-"),s(" mongodb_data"),n("span",{class:"token punctuation"},":"),s(`/bitnami/mongodb
     `),n("span",{class:"token key atrule"},"environment"),n("span",{class:"token punctuation"},":"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_REPLICA_SET_MODE"),n("span",{class:"token punctuation"},":"),s(` primary
       `),n("span",{class:"token key atrule"},"MONGODB_REPLICA_SET_NAME"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_REPLICA_SET_NAME"),n("span",{class:"token punctuation"},":"),n("span",{class:"token punctuation"},"-"),s("rs0"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_PORT_NUMBER"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_PORT_NUMBER"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"-27017"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_INITIAL_PRIMARY_HOST"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_INITIAL_PRIMARY_HOST"),n("span",{class:"token punctuation"},":"),n("span",{class:"token punctuation"},"-"),s("mongodb"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_INITIAL_PRIMARY_PORT_NUMBER"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_INITIAL_PRIMARY_PORT_NUMBER"),n("span",{class:"token punctuation"},":"),n("span",{class:"token number"},"-27017"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_ADVERTISED_HOSTNAME"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_ADVERTISED_HOSTNAME"),n("span",{class:"token punctuation"},":"),n("span",{class:"token punctuation"},"-"),s("mongodb"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"MONGODB_ENABLE_JOURNAL"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("MONGODB_ENABLE_JOURNAL"),n("span",{class:"token punctuation"},":"),n("span",{class:"token punctuation"},"-"),n("span",{class:"token boolean important"},"true"),n("span",{class:"token punctuation"},"}"),s(`
       `),n("span",{class:"token key atrule"},"ALLOW_EMPTY_PASSWORD"),n("span",{class:"token punctuation"},":"),s(" $"),n("span",{class:"token punctuation"},"{"),s("ALLOW_EMPTY_PASSWORD"),n("span",{class:"token punctuation"},":"),n("span",{class:"token punctuation"},"-"),s("yes"),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),v=c(`<p>使用<code>docker compose up -d</code>启动容器。</p><h2 id="重置管理员密码-可选" tabindex="-1"><a class="header-anchor" href="#重置管理员密码-可选" aria-hidden="true">#</a> 重置管理员密码（可选）</h2><p>进入mongo容器：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rocketchat-mongodb-1 /bin/bash
mongsh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mongodb line-numbers-mode" data-ext="mongodb"><pre class="language-mongodb"><code>use rocketchat
db<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token property">username</span><span class="token operator">:</span><span class="token string">&quot;rc.admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token property"><span class="token keyword">$set</span></span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;services&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;password&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&quot;bcrypt&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;$2a$10$n9CM8OgInDlwpvjLKLPML.eizXIzLlRtgCh3GRLafOdR9ldAUh/KG&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置https" tabindex="-1"><a class="header-anchor" href="#配置https" aria-hidden="true">#</a> 配置HTTPS</h2><p>创建nginx配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/sites-enabled/rocketchat.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,8),_=n("div",{class:"language-nginx line-numbers-mode","data-ext":"nginx"},[n("pre",{class:"language-nginx"},[n("code",null,[s(),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"server")]),s(),n("span",{class:"token punctuation"},"{"),s(`
     `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"listen"),s(),n("span",{class:"token number"},"44443"),s(" ssl http2")]),n("span",{class:"token punctuation"},";"),s(`
     `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"listen"),s(" [::]:44443 ssl http2")]),n("span",{class:"token punctuation"},";"),s(`
     `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"server_name"),s(" demo.mydomain.com")]),n("span",{class:"token punctuation"},";"),s(`

     `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"location"),s(" /")]),s(),n("span",{class:"token punctuation"},"{"),s(`
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_pass"),s(" http://127.0.0.1:3000")]),n("span",{class:"token punctuation"},";"),s(`
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_http_version"),s(" 1.1")]),n("span",{class:"token punctuation"},";"),s(`  
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_set_header"),s(" X-Forwarded-For "),n("span",{class:"token variable"},"$proxy_add_x_forwarded_for")]),n("span",{class:"token punctuation"},";"),s(`
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_set_header"),s(" Host "),n("span",{class:"token variable"},"$host")]),n("span",{class:"token punctuation"},";"),s(` 
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_set_header"),s(" Upgrade "),n("span",{class:"token variable"},"$http_upgrade")]),n("span",{class:"token punctuation"},";"),s(`
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_set_header"),s(" Connection "),n("span",{class:"token string"},'"upgrade"')]),n("span",{class:"token punctuation"},";"),s(`
         `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"proxy_set_header"),s(" Host "),n("span",{class:"token variable"},"$host")]),n("span",{class:"token punctuation"},";"),s(`
     `),n("span",{class:"token punctuation"},"}"),s(`
     `),n("span",{class:"token directive"},[n("span",{class:"token keyword"},"include"),s(" /etc/nginx/templates/ssl.tmpl")]),n("span",{class:"token punctuation"},";"),s(`
 `),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=c(`<p>重启nginx:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2),g={href:"https://demo.mydomain.com:44443",target:"_blank",rel:"noopener noreferrer"},y=n("p",null,[n("strong",null,"安装过程到此结束，下面是有可能出现的问题，如果没有出现该问题则忽略后面的内容。")],-1),O=n("div",{class:"hint-container note"},[n("p",{class:"hint-container-title"},"注"),n("p",null,"如果服务器重启后导致rocketchat-rocketchat-1无法启动，如果检查日志发现是无法连接mongodb导致的话，有可能是compose文件中的admin.rc用户的密码与mongodb中存贮的密码不匹配导致的可以用如下脚本生成对应密码的bcrypt字符串。")],-1),N=n("div",{class:"language-python line-numbers-mode","data-ext":"py"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(` bcrypt

`),n("span",{class:"token comment"},"# 要加密的字符串"),s(`
input_string `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"123456"'),s(`

`),n("span",{class:"token comment"},"# 生成bcrypt哈希值"),s(`
hashed `),n("span",{class:"token operator"},"="),s(" bcrypt"),n("span",{class:"token punctuation"},"."),s("hashpw"),n("span",{class:"token punctuation"},"("),s("input_string"),n("span",{class:"token punctuation"},"."),s("encode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'utf-8'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" bcrypt"),n("span",{class:"token punctuation"},"."),s("gensalt"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`

`),n("span",{class:"token comment"},"# 打印哈希值"),s(`
`),n("span",{class:"token keyword"},"print"),n("span",{class:"token punctuation"},"("),s("hashed"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=c(`<p>执行这个文件后会获得对应的bcrypt字符串，然后在compose文件中把bcrypt字符串修改为生成的字符串，重新build</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose up <span class="token parameter variable">--build</span> rocketchat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2);function A(R,E){const l=p("CodeTabs"),i=p("ExternalLinkIcon");return r(),k("div",null,[m,o(l,{id:"4",data:[{id:"docker-compose.yml"}],"tab-id":"language"},{title0:a(({value:e,isActive:t})=>[s("docker-compose.yml")]),tab0:a(({value:e,isActive:t})=>[b]),_:1},8,["data"]),v,o(l,{id:"27",data:[{id:"rocketchat.conf"}],"tab-id":"language"},{title0:a(({value:e,isActive:t})=>[s("rocketchat.conf")]),tab0:a(({value:e,isActive:t})=>[_]),_:1},8,["data"]),h,n("p",null,[s("在浏览器中打开链接: "),n("a",g,[s("https://demo.mydomain.com:44443"),o(i)]),s(" 根据指引完成初始化操作。")]),y,O,o(l,{id:"48",data:[{id:"demo.py"}],"tab-id":"language"},{title0:a(({value:e,isActive:t})=>[s("demo.py")]),tab0:a(({value:e,isActive:t})=>[N]),_:1},8,["data"]),M])}const T=u(d,[["render",A],["__file","install.html.vue"]]);export{T as default};
